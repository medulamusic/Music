<html class="scroll-smooth" lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Spotify Clone Web Player
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Poppins', sans-serif;
      background-color: #121212;
      color: #fff;
    }
    /* Scrollbar for playlist and search results */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #181818;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #1db954;
      border-radius: 10px;
    }
    /* Hide iframe scrollbar */
    iframe::-webkit-scrollbar {
      display: none;
    }
  </style>
 </head>
 <body class="flex flex-col h-screen overflow-hidden">
  <!-- HEADER / SEARCH BAR -->
  <header class="fixed top-0 left-0 right-0 bg-[#121212] z-30 border-b border-gray-800 transition-transform duration-300" id="header">
   <div class="max-w-4xl mx-auto px-4 py-3 flex items-center space-x-3" id="searchBarContainer">
    <button aria-label="Back from search" class="text-gray-400 hover:text-white text-xl hidden" id="searchBackBtn">
     <i class="fas fa-arrow-left">
     </i>
    </button>
    <input aria-label="Search music" autocomplete="off" class="flex-grow bg-[#282828] rounded-full py-2 px-4 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 transition" id="searchInput" placeholder="Search for artists, songs, or podcasts" type="search"/>
   </div>
  </header>
  <!-- MAIN CONTENT -->
  <main class="flex-grow pt-16 pb-24 overflow-y-auto max-w-4xl mx-auto w-full" id="mainContent">
   <!-- Home Screen -->
   <section class="px-4 space-y-6" id="homeScreen">
    <h2 class="text-2xl font-semibold mb-2">
     Good Evening
    </h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4" id="homePlaylists">
     <div aria-label="Playlist: Chill Vibes" class="bg-[#181818] rounded-lg flex items-center space-x-4 p-3 cursor-pointer hover:bg-[#282828] transition" role="button" tabindex="0">
      <img alt="Album cover with abstract blue and purple waves representing Chill Vibes playlist" class="w-20 h-20 rounded-md object-cover" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/fa748b97-8b0a-4818-fd80-f8207bab5aee.jpg" width="80"/>
      <p class="font-semibold truncate">
       Chill Vibes
      </p>
     </div>
     <div aria-label="Playlist: Top Hits 2024" class="bg-[#181818] rounded-lg flex items-center space-x-4 p-3 cursor-pointer hover:bg-[#282828] transition" role="button" tabindex="0">
      <img alt="Album cover with colorful geometric shapes representing Top Hits 2024 playlist" class="w-20 h-20 rounded-md object-cover" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/9e7d35ce-f506-42d0-d844-51e438bb7b12.jpg" width="80"/>
      <p class="font-semibold truncate">
       Top Hits 2024
      </p>
     </div>
     <div aria-label="Playlist: Workout Mix" class="bg-[#181818] rounded-lg flex items-center space-x-4 p-3 cursor-pointer hover:bg-[#282828] transition" role="button" tabindex="0">
      <img alt="Album cover with energetic red and orange abstract shapes representing Workout Mix playlist" class="w-20 h-20 rounded-md object-cover" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/a84bb3fe-1d64-43db-5724-610462030d4f.jpg" width="80"/>
      <p class="font-semibold truncate">
       Workout Mix
      </p>
     </div>
     <div aria-label="Playlist: Jazz Classics" class="bg-[#181818] rounded-lg flex items-center space-x-4 p-3 cursor-pointer hover:bg-[#282828] transition" role="button" tabindex="0">
      <img alt="Album cover with vintage microphone and warm brown tones representing Jazz Classics playlist" class="w-20 h-20 rounded-md object-cover" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/a301f139-c61c-416c-2d54-f0e1510a1665.jpg" width="80"/>
      <p class="font-semibold truncate">
       Jazz Classics
      </p>
     </div>
     <div aria-label="Playlist: Indie Spotlight" class="bg-[#181818] rounded-lg flex items-center space-x-4 p-3 cursor-pointer hover:bg-[#282828] transition" role="button" tabindex="0">
      <img alt="Album cover with indie band performing on stage with purple lighting representing Indie Spotlight playlist" class="w-20 h-20 rounded-md object-cover" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/1e9cad92-d705-427b-c8c7-a1a142cf2586.jpg" width="80"/>
      <p class="font-semibold truncate">
       Indie Spotlight
      </p>
     </div>
     <div aria-label="Playlist: Relax &amp; Unwind" class="bg-[#181818] rounded-lg flex items-center space-x-4 p-3 cursor-pointer hover:bg-[#282828] transition" role="button" tabindex="0">
      <img alt="Album cover with calm ocean waves and sunset colors representing Relax and Unwind playlist" class="w-20 h-20 rounded-md object-cover" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/93be3238-8095-4649-61d0-041ed0c985f0.jpg" width="80"/>
      <p class="font-semibold truncate">
       Relax &amp; Unwind
      </p>
     </div>
     <div aria-label="Playlist: Party Time" class="bg-[#181818] rounded-lg flex items-center space-x-4 p-3 cursor-pointer hover:bg-[#282828] transition" role="button" tabindex="0">
      <img alt="Album cover with disco ball and colorful lights representing Party Time playlist" class="w-20 h-20 rounded-md object-cover" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/af3e2667-c7c5-46ef-9f21-19790757a99f.jpg" width="80"/>
      <p class="font-semibold truncate">
       Party Time
      </p>
     </div>
     <div aria-label="Playlist: Focus Beats" class="bg-[#181818] rounded-lg flex items-center space-x-4 p-3 cursor-pointer hover:bg-[#282828] transition" role="button" tabindex="0">
      <img alt="Album cover with abstract blue and green lines representing Focus Beats playlist" class="w-20 h-20 rounded-md object-cover" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/5042786f-06fc-49ab-fc4f-5b11e7041c4c.jpg" width="80"/>
      <p class="font-semibold truncate">
       Focus Beats
      </p>
     </div>
    </div>
   </section>
   <!-- Search Screen -->
   <section aria-label="Search results" class="hidden px-4 space-y-6" id="searchScreen">
    <h2 class="text-2xl font-semibold mb-2">
     Search Results
    </h2>
    <div class="space-y-4 max-h-[60vh] overflow-y-auto" id="searchResults">
    </div>
   </section>
   <!-- Library Screen -->
   <section aria-label="Your Library" class="hidden px-4 space-y-6" id="libraryScreen">
    <h2 class="text-2xl font-semibold mb-2">
     Your Library
    </h2>
    <p class="text-gray-400">
     Your saved songs will appear here.
    </p>
    <ul class="space-y-3 max-h-[60vh] overflow-y-auto" id="savedSongsList">
    </ul>
   </section>
   <!-- Premium Screen -->
   <section aria-label="Premium" class="hidden px-4 space-y-6" id="premiumScreen">
    <h2 class="text-2xl font-semibold mb-2">
     Spotify Premium
    </h2>
    <div class="bg-[#181818] rounded-lg p-6 flex flex-col items-center text-center space-y-4">
     <img alt="Spotify Premium logo with green circle and white text" class="w-40 h-40 object-contain" height="200" loading="lazy" src="https://storage.googleapis.com/a1aa/image/f86d1cd2-7d0d-40c0-bffb-6cadc1af7010.jpg" width="200"/>
     <p class="text-gray-300 max-w-md">
      Get Premium to enjoy ad-free music, offline listening, and more.
     </p>
     <button aria-label="Get Premium" class="bg-green-500 hover:bg-green-600 text-black font-semibold rounded-full px-6 py-3 transition">
      Get Premium
     </button>
    </div>
   </section>
   <!-- Create Screen -->
   <section aria-label="Create Playlist" class="hidden px-4 space-y-6" id="createScreen">
    <h2 class="text-2xl font-semibold mb-2">
     Create Playlist
    </h2>
    <form class="space-y-4 max-w-md" id="createPlaylistForm">
     <div>
      <label class="block mb-1 font-semibold text-gray-300" for="playlistName">
       Playlist Name
      </label>
      <input class="w-full rounded-md bg-[#282828] border border-gray-700 px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500" id="playlistName" name="playlistName" placeholder="My Playlist" required="" type="text"/>
     </div>
     <div>
      <label class="block mb-1 font-semibold text-gray-300" for="playlistDescription">
       Description
      </label>
      <textarea class="w-full rounded-md bg-[#282828] border border-gray-700 px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500" id="playlistDescription" name="playlistDescription" placeholder="Describe your playlist" rows="3"></textarea>
     </div>
     <button aria-label="Create Playlist" class="bg-green-500 hover:bg-green-600 text-black font-semibold rounded-full px-6 py-3 transition" type="submit">
      Create
     </button>
    </form>
    <div class="space-y-4 mt-6" id="createdPlaylists">
    </div>
   </section>
  </main>
  <!-- PLAYER CONTROLS -->
  <footer aria-label="Music player controls" class="fixed bottom-16 left-0 right-0 bg-[#181818] border-t border-gray-800 flex flex-col md:flex-row items-center justify-between px-4 py-3 max-w-4xl mx-auto w-full z-30" id="player">
   <div class="flex items-center space-x-4 w-full md:w-1/3 min-w-[180px]">
    <img alt="Current song cover art" class="w-14 h-14 rounded-md object-cover" height="56" id="playerCover" loading="lazy" src="https://storage.googleapis.com/a1aa/image/003152ea-fb72-46ad-10fa-f7a3515a471e.jpg" width="56"/>
    <div class="flex flex-col truncate">
     <p aria-atomic="true" aria-live="polite" class="font-semibold truncate text-white" id="playerTitle">
      Not Playing
     </p>
     <p aria-atomic="true" aria-live="polite" class="text-gray-400 text-sm truncate" id="playerArtist">
      -
     </p>
    </div>
    <button aria-label="Save song to library" class="ml-auto text-gray-400 hover:text-green-500 focus:outline-none" id="saveSongBtn" title="Save song">
     <i class="far fa-heart">
     </i>
    </button>
   </div>
   <div class="flex flex-col items-center space-y-1 w-full md:w-1/3 max-w-lg">
    <div class="flex items-center space-x-6">
     <button aria-label="Previous song" class="text-gray-400 hover:text-white text-xl focus:outline-none" id="prevBtn">
      <i class="fas fa-step-backward">
      </i>
     </button>
     <button aria-label="Play or pause" class="text-white text-3xl focus:outline-none" id="playPauseBtn">
      <i class="fas fa-play">
      </i>
     </button>
     <button aria-label="Next song" class="text-gray-400 hover:text-white text-xl focus:outline-none" id="nextBtn">
      <i class="fas fa-step-forward">
      </i>
     </button>
    </div>
    <div class="flex items-center space-x-2 w-full">
     <span class="text-xs text-gray-400 w-10 text-right" id="currentTime">
      0:00
     </span>
     <input aria-label="Song progress" class="w-full h-1 rounded-lg cursor-pointer accent-green-500" id="progressBar" max="100" min="0" step="0.1" type="range" value="0"/>
     <span class="text-xs text-gray-400 w-10 text-left" id="duration">
      0:00
     </span>
    </div>
   </div>
   <div aria-label="Volume and additional controls" class="hidden md:flex items-center space-x-4 w-1/3 justify-end min-w-[180px]">
    <button aria-label="Toggle shuffle" class="text-gray-400 hover:text-green-500 text-lg focus:outline-none" id="shuffleBtn" title="Shuffle">
     <i class="fas fa-random">
     </i>
    </button>
    <button aria-label="Toggle repeat" class="text-gray-400 hover:text-green-500 text-lg focus:outline-none" id="repeatBtn" title="Repeat">
     <i class="fas fa-redo">
     </i>
    </button>
    <i class="fas fa-volume-up text-gray-400">
    </i>
    <input aria-label="Volume control" class="w-24 h-1 rounded-lg cursor-pointer accent-green-500" id="volumeBar" max="1" min="0" step="0.01" type="range" value="0.5"/>
   </div>
  </footer>
  <!-- BOTTOM NAVIGATION -->
  <nav aria-label="Main navigation" class="fixed bottom-0 left-0 right-0 bg-[#121212] border-t border-gray-800 flex justify-around items-center h-16 z-40" id="bottomNav" role="navigation">
   <button aria-current="page" aria-label="Home" class="flex flex-col items-center justify-center text-gray-400 hover:text-green-500 focus:text-green-500 focus:outline-none" id="navHome">
    <i class="fas fa-home text-xl">
    </i>
    <span class="text-xs mt-1">
     Home
    </span>
   </button>
   <button aria-label="Search" class="flex flex-col items-center justify-center text-gray-400 hover:text-green-500 focus:text-green-500 focus:outline-none" id="navSearch">
    <i class="fas fa-search text-xl">
    </i>
    <span class="text-xs mt-1">
     Search
    </span>
   </button>
   <button aria-label="Library" class="flex flex-col items-center justify-center text-gray-400 hover:text-green-500 focus:text-green-500 focus:outline-none" id="navLibrary">
    <i class="fas fa-book text-xl">
    </i>
    <span class="text-xs mt-1">
     Library
    </span>
   </button>
   <button aria-label="Premium" class="flex flex-col items-center justify-center text-gray-400 hover:text-green-500 focus:text-green-500 focus:outline-none" id="navPremium">
    <i class="fas fa-crown text-xl">
    </i>
    <span class="text-xs mt-1">
     Premium
    </span>
   </button>
   <button aria-label="Create" class="flex flex-col items-center justify-center text-gray-400 hover:text-green-500 focus:text-green-500 focus:outline-none" id="navCreate">
    <i class="fas fa-plus-circle text-xl">
    </i>
    <span class="text-xs mt-1">
     Create
    </span>
   </button>
  </nav>
  <audio id="audioPlayer" preload="metadata">
  </audio>
  <script>
   // YouTube API key
    const YOUTUBE_API_KEY = 'AIzaSyBMoCaQKkDU2SaVeCY7MUIvtyqvrWvYgYA';

    // State variables
    const audio = document.getElementById('audioPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressBar = document.getElementById('progressBar');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const playerTitle = document.getElementById('playerTitle');
    const playerArtist = document.getElementById('playerArtist');
    const playerCover = document.getElementById('playerCover');
    const saveSongBtn = document.getElementById('saveSongBtn');
    const volumeBar = document.getElementById('volumeBar');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const repeatBtn = document.getElementById('repeatBtn');

    const navHome = document.getElementById('navHome');
    const navSearch = document.getElementById('navSearch');
    const navLibrary = document.getElementById('navLibrary');
    const navPremium = document.getElementById('navPremium');
    const navCreate = document.getElementById('navCreate');

    const homeScreen = document.getElementById('homeScreen');
    const searchScreen = document.getElementById('searchScreen');
    const libraryScreen = document.getElementById('libraryScreen');
    const premiumScreen = document.getElementById('premiumScreen');
    const createScreen = document.getElementById('createScreen');

    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const savedSongsList = document.getElementById('savedSongsList');
    const createdPlaylists = document.getElementById('createdPlaylists');
    const createPlaylistForm = document.getElementById('createPlaylistForm');
    const searchBarContainer = document.getElementById('searchBarContainer');
    const searchBackBtn = document.getElementById('searchBackBtn');
    const header = document.getElementById('header');

    // State
    let currentPlaylist = [];
    let currentIndex = 0;
    let isPlaying = false;
    let isShuffle = false;
    let isRepeat = false;
    let savedSongs = JSON.parse(localStorage.getItem('savedSongs')) || [];
    let createdPlaylistsData = JSON.parse(localStorage.getItem('createdPlaylists')) || [];

    // Initialize volume
    audio.volume = volumeBar.value;

    // UTILITIES
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60) || 0;
      const secs = Math.floor(seconds % 60) || 0;
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    // RENDER SAVED SONGS
    function renderSavedSongs() {
      savedSongsList.innerHTML = '';
      if (savedSongs.length === 0) {
        savedSongsList.innerHTML =
          '<p class="text-gray-400">No saved songs yet. Play and save your favorites!</p>';
        return;
      }
      savedSongs.forEach((song, i) => {
        const li = document.createElement('li');
        li.className =
          'flex items-center space-x-4 bg-[#181818] rounded-md p-2 cursor-pointer hover:bg-[#282828] transition';
        li.setAttribute('tabindex', '0');
        li.setAttribute('role', 'button');
        li.setAttribute('aria-label', `Play saved song: ${song.title} by ${song.artist}`);

        li.innerHTML = `
          <img src="${song.cover}" alt="Cover art of ${song.title} by ${song.artist}" class="w-12 h-12 rounded-md object-cover" loading="lazy" />
          <div class="flex flex-col truncate">
            <p class="font-semibold truncate">${song.title}</p>
            <p class="text-gray-400 text-sm truncate">${song.artist}</p>
          </div>
          <button aria-label="Remove from saved songs" title="Remove from saved songs" class="text-gray-400 hover:text-red-500 focus:outline-none remove-saved-song">
            <i class="fas fa-trash-alt"></i>
          </button>
        `;

        li.querySelector('button.remove-saved-song').addEventListener('click', (e) => {
          e.stopPropagation();
          savedSongs.splice(i, 1);
          localStorage.setItem('savedSongs', JSON.stringify(savedSongs));
          renderSavedSongs();
        });

        li.addEventListener('click', () => {
          playSong(song);
        });

        savedSongsList.appendChild(li);
      });
    }

    // RENDER CREATED PLAYLISTS
    function renderCreatedPlaylists() {
      createdPlaylists.innerHTML = '';
      if (createdPlaylistsData.length === 0) {
        createdPlaylists.innerHTML =
          '<p class="text-gray-400">No playlists created yet. Create your own!</p>';
        return;
      }
      createdPlaylistsData.forEach((pl, i) => {
        const div = document.createElement('div');
        div.className = 'bg-[#181818] rounded-md p-4';
        div.innerHTML = `
          <h3 class="font-semibold text-lg mb-1">${pl.name}</h3>
          <p class="text-gray-400 mb-2">${pl.description || 'No description'}</p>
          <p class="text-gray-400 text-sm">Songs: ${pl.songs.length}</p>
          <button aria-label="Delete playlist ${pl.name}" title="Delete playlist" class="mt-2 bg-red-600 hover:bg-red-700 text-white rounded-full px-4 py-1 text-sm focus:outline-none delete-playlist-btn">Delete</button>
        `;
        div.querySelector('button.delete-playlist-btn').addEventListener('click', () => {
          createdPlaylistsData.splice(i, 1);
          localStorage.setItem('createdPlaylists', JSON.stringify(createdPlaylistsData));
          renderCreatedPlaylists();
        });
        createdPlaylists.appendChild(div);
      });
    }

    // PLAY SONG
    function playSong(song) {
      if (song.source === 'youtube') {
        playYouTubeSong(song);
      } else {
        if (!song.preview) {
          alert('No preview available for this song.');
          return;
        }
        stopYouTubePlayer();
        audio.src = song.preview;
        audio.play();
        isPlaying = true;
        updatePlayPauseBtn();
        playerTitle.textContent = song.title;
        playerArtist.textContent = song.artist;
        playerCover.src = song.cover;
        playerCover.alt = `Cover art of ${song.title} by ${song.artist}`;
        currentPlaylist = [song];
        currentIndex = 0;
        updateSaveButton();
      }
    }

    // PLAY CURRENT INDEX SONG
    function playCurrentIndex() {
      if (currentPlaylist.length === 0) return;
      const song = currentPlaylist[currentIndex];
      playSong(song);
    }

    // UPDATE PLAY/PAUSE BUTTON ICON
    function updatePlayPauseBtn() {
      playPauseBtn.innerHTML = isPlaying
        ? '<i class="fas fa-pause"></i>'
        : '<i class="fas fa-play"></i>';
    }

    // UPDATE SAVE BUTTON ICON
    function updateSaveButton() {
      if (currentPlaylist.length === 0) {
        saveSongBtn.innerHTML = '<i class="far fa-heart"></i>';
        return;
      }
      const song = currentPlaylist[currentIndex];
      const saved = savedSongs.find((s) => s.id === song.id);
      saveSongBtn.innerHTML = saved
        ? '<i class="fas fa-heart text-green-500"></i>'
        : '<i class="far fa-heart"></i>';
    }

    // SAVE SONG TO LIBRARY
    function saveSong(song) {
      if (savedSongs.find((s) => s.id === song.id)) return;
      savedSongs.push(song);
      localStorage.setItem('savedSongs', JSON.stringify(savedSongs));
      renderSavedSongs();
      updateSaveButton();
    }

    // TOGGLE SAVE CURRENT SONG
    saveSongBtn.addEventListener('click', () => {
      if (currentPlaylist.length === 0) return;
      const song = currentPlaylist[currentIndex];
      const index = savedSongs.findIndex((s) => s.id === song.id);
      if (index === -1) {
        saveSong(song);
      } else {
        savedSongs.splice(index, 1);
        localStorage.setItem('savedSongs', JSON.stringify(savedSongs));
        renderSavedSongs();
        updateSaveButton();
      }
    });

    // PLAY/PAUSE TOGGLE
    playPauseBtn.addEventListener('click', () => {
      if (currentPlaylist.length === 0) return;
      const song = currentPlaylist[currentIndex];
      if (song.source === 'youtube') {
        toggleYouTubePlayPause();
      } else {
        if (isPlaying) {
          audio.pause();
        } else {
          audio.play();
        }
      }
    });

    audio.addEventListener('play', () => {
      isPlaying = true;
      updatePlayPauseBtn();
    });

    audio.addEventListener('pause', () => {
      isPlaying = false;
      updatePlayPauseBtn();
    });

    // UPDATE PROGRESS BAR AND TIME
    audio.addEventListener('timeupdate', () => {
      if (!audio.duration) return;
      const progressPercent = (audio.currentTime / audio.duration) * 100;
      progressBar.value = progressPercent;
      currentTimeEl.textContent = formatTime(audio.currentTime);
      durationEl.textContent = formatTime(audio.duration);
    });

    // SEEK AUDIO
    progressBar.addEventListener('input', () => {
      if (currentPlaylist.length === 0) return;
      const song = currentPlaylist[currentIndex];
      if (song.source === 'youtube') {
        if (youtubePlayer && youtubePlayer.seekTo) {
          const seekTime = (progressBar.value / 100) * youtubePlayer.getDuration();
          youtubePlayer.seekTo(seekTime, true);
        }
      } else {
        if (!audio.duration) return;
        const seekTime = (progressBar.value / 100) * audio.duration;
        audio.currentTime = seekTime;
      }
    });

    // VOLUME CONTROL
    volumeBar.addEventListener('input', () => {
      audio.volume = volumeBar.value;
      if (youtubePlayer) {
        youtubePlayer.setVolume(volumeBar.value * 100);
      }
    });

    // PREV/NEXT BUTTONS
    prevBtn.addEventListener('click', () => {
      if (currentPlaylist.length === 0) return;
      if (isShuffle) {
        currentIndex = Math.floor(Math.random() * currentPlaylist.length);
      } else {
        currentIndex--;
        if (currentIndex < 0) currentIndex = currentPlaylist.length - 1;
      }
      playCurrentIndex();
    });

    nextBtn.addEventListener('click', () => {
      if (currentPlaylist.length === 0) return;
      if (isShuffle) {
        currentIndex = Math.floor(Math.random() * currentPlaylist.length);
      } else {
        currentIndex++;
        if (currentIndex >= currentPlaylist.length) {
          if (isRepeat) {
            currentIndex = 0;
          } else {
            if (currentPlaylist[currentIndex - 1].source === 'youtube') {
              stopYouTubePlayer();
            } else {
              audio.pause();
            }
            return;
          }
        }
      }
      playCurrentIndex();
    });

    // SHUFFLE TOGGLE
    shuffleBtn.addEventListener('click', () => {
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle('text-green-500', isShuffle);
    });

    // REPEAT TOGGLE
    repeatBtn.addEventListener('click', () => {
      isRepeat = !isRepeat;
      repeatBtn.classList.toggle('text-green-500', isRepeat);
    });

    // AUDIO ENDED EVENT
    audio.addEventListener('ended', () => {
      if (isRepeat) {
        playCurrentIndex();
      } else {
        nextBtn.click();
      }
    });

    // NAVIGATION HANDLERS
    function setActiveNav(button) {
      [navHome, navSearch, navLibrary, navPremium, navCreate].forEach((btn) => {
        btn.classList.remove('text-green-500');
        btn.classList.add('text-gray-400');
        btn.setAttribute('aria-current', 'false');
      });
      button.classList.add('text-green-500');
      button.setAttribute('aria-current', 'page');
    }

    function showScreen(screen) {
      [homeScreen, searchScreen, libraryScreen, premiumScreen, createScreen].forEach(
        (sec) => (sec.style.display = 'none')
      );
      screen.style.display = 'block';
    }

    navHome.addEventListener('click', () => {
      setActiveNav(navHome);
      showScreen(homeScreen);
      hideSearchBar();
      hideYouTubePlayer();
    });

    navSearch.addEventListener('click', () => {
      setActiveNav(navSearch);
      showScreen(searchScreen);
      showSearchBar();
      searchInput.focus();
      hideYouTubePlayer();
    });

    navLibrary.addEventListener('click', () => {
      setActiveNav(navLibrary);
      showScreen(libraryScreen);
      hideSearchBar();
      renderSavedSongs();
      hideYouTubePlayer();
    });

    navPremium.addEventListener('click', () => {
      setActiveNav(navPremium);
      showScreen(premiumScreen);
      hideSearchBar();
      hideYouTubePlayer();
    });

    navCreate.addEventListener('click', () => {
      setActiveNav(navCreate);
      showScreen(createScreen);
      hideSearchBar();
      renderCreatedPlaylists();
      hideYouTubePlayer();
    });

    // SEARCH BAR SHOW/HIDE
    function showSearchBar() {
      header.style.transform = 'translateY(0)';
      searchBackBtn.classList.remove('hidden');
      searchInput.value = '';
      searchResults.innerHTML = '';
      searchInput.focus();
    }

    function hideSearchBar() {
      header.style.transform = 'translateY(0)';
      searchBackBtn.classList.add('hidden');
      searchInput.value = '';
      searchResults.innerHTML = '';
    }

    searchBackBtn.addEventListener('click', () => {
      navHome.click();
    });

    // SEARCH INPUT EVENT
    let searchTimeout;
    searchInput.addEventListener('input', () => {
      clearTimeout(searchTimeout);
      const query = searchInput.value.trim();
      if (query.length === 0) {
        searchResults.innerHTML = '';
        return;
      }
      searchTimeout = setTimeout(() => {
        searchSongs(query);
      }, 500);
    });

    // CREATE PLAYLIST FORM
    createPlaylistForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = createPlaylistForm.playlistName.value.trim();
      const description = createPlaylistForm.playlistDescription.value.trim();
      if (!name) return;
      createdPlaylistsData.push({ name, description, songs: [] });
      localStorage.setItem('createdPlaylists', JSON.stringify(createdPlaylistsData));
      renderCreatedPlaylists();
      createPlaylistForm.reset();
      alert(`Playlist "${name}" created!`);
    });

    // YOUTUBE PLAYER SETUP
    let youtubePlayer;
    let youtubePlayerReady = false;
    let youtubeCurrentVideoId = null;
    let youtubeProgressInterval;

    // Create YouTube player container
    const ytPlayerContainer = document.createElement('div');
    ytPlayerContainer.id = 'ytPlayerContainer';
    ytPlayerContainer.style.position = 'fixed';
    ytPlayerContainer.style.bottom = '96px';
    ytPlayerContainer.style.left = '50%';
    ytPlayerContainer.style.transform = 'translateX(-50%)';
    ytPlayerContainer.style.zIndex = '50';
    ytPlayerContainer.style.width = '320px';
    ytPlayerContainer.style.height = '180px';
    ytPlayerContainer.style.borderRadius = '12px';
    ytPlayerContainer.style.overflow = 'hidden';
    ytPlayerContainer.style.backgroundColor = '#000';
    ytPlayerContainer.style.display = 'none';
    document.body.appendChild(ytPlayerContainer);

    // Load YouTube IFrame API
    function loadYouTubeAPI() {
      return new Promise((resolve) => {
        if (window.YT && window.YT.Player) {
          resolve();
          return;
        }
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        window.onYouTubeIframeAPIReady = () => {
          resolve();
        };
      });
    }

    // Initialize YouTube player
    async function initYouTubePlayer() {
      await loadYouTubeAPI();
      youtubePlayer = new YT.Player('ytPlayerContainer', {
        height: '180',
        width: '320',
        videoId: '',
        playerVars: {
          autoplay: 0,
          controls: 0,
          modestbranding: 1,
          rel: 0,
          showinfo: 0,
          iv_load_policy: 3,
          disablekb: 1,
          fs: 0,
        },
        events: {
          onReady: () => {
            youtubePlayerReady = true;
            youtubePlayer.setVolume(volumeBar.value * 100);
          },
          onStateChange: onYouTubePlayerStateChange,
        },
      });
    }

    // Play YouTube song
    async function playYouTubeSong(song) {
      if (!youtubePlayerReady) {
        await initYouTubePlayer();
      }
      if (youtubeCurrentVideoId !== song.youtubeVideoId) {
        youtubeCurrentVideoId = song.youtubeVideoId;
        youtubePlayer.loadVideoById(song.youtubeVideoId);
      } else {
        youtubePlayer.playVideo();
      }
      isPlaying = true;
      updatePlayPauseBtn();
      playerTitle.textContent = song.title;
      playerArtist.textContent = song.artist;
      playerCover.src = song.cover;
      playerCover.alt = `Cover art of ${song.title} by ${song.artist}`;
      currentPlaylist = [song];
      currentIndex = 0;
      updateSaveButton();
      showYouTubePlayer();
      audio.pause();
    }

    // Show YouTube player container
    function showYouTubePlayer() {
      ytPlayerContainer.style.display = 'block';
      startYouTubeProgressUpdater();
    }

    // Hide YouTube player container
    function hideYouTubePlayer() {
      ytPlayerContainer.style.display = 'none';
      stopYouTubeProgressUpdater();
    }

    // Toggle YouTube play/pause
    function toggleYouTubePlayPause() {
      if (!youtubePlayer) return;
      const state = youtubePlayer.getPlayerState();
      if (state === YT.PlayerState.PLAYING) {
        youtubePlayer.pauseVideo();
      } else if (state === YT.PlayerState.PAUSED || state === YT.PlayerState.ENDED) {
        youtubePlayer.playVideo();
      }
    }

    // YouTube player state change handler
    function onYouTubePlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        isPlaying = true;
        updatePlayPauseBtn();
      } else if (event.data === YT.PlayerState.PAUSED) {
        isPlaying = false;
        updatePlayPauseBtn();
      } else if (event.data === YT.PlayerState.ENDED) {
        if (isRepeat) {
          youtubePlayer.playVideo();
        } else {
          nextBtn.click();
        }
      }
    }

    // Stop YouTube player
    function stopYouTubePlayer() {
      if (youtubePlayer) {
        youtubePlayer.stopVideo();
      }
      isPlaying = false;
      updatePlayPauseBtn();
      hideYouTubePlayer();
    }

    // Update progress bar for YouTube player
    function startYouTubeProgressUpdater() {
      stopYouTubeProgressUpdater();
      youtubeProgressInterval = setInterval(() => {
        if (!youtubePlayer || !youtubePlayer.getDuration) return;
        const duration = youtubePlayer.getDuration();
        const currentTime = youtubePlayer.getCurrentTime();
        if (duration > 0) {
          const progressPercent = (currentTime / duration) * 100;
          progressBar.value = progressPercent;
          currentTimeEl.textContent = formatTime(currentTime);
          durationEl.textContent = formatTime(duration);
        }
      }, 500);
    }

    function stopYouTubeProgressUpdater() {
      if (youtubeProgressInterval) {
        clearInterval(youtubeProgressInterval);
        youtubeProgressInterval = null;
      }
    }

    // SEARCH FUNCTIONALITY USING YOUTUBE API
    async function searchSongs(query) {
      if (!query) {
        searchResults.innerHTML = '';
        return;
      }
      searchResults.innerHTML =
        '<p class="text-gray-400">Searching...</p>';
      try {
        const response = await fetch(
          `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=20&q=${encodeURIComponent(
            query + ' audio'
          )}&key=${YOUTUBE_API_KEY}`
        );
        if (!response.ok) throw new Error('API error');
        const data = await response.json();
        if (!data.items || data.items.length === 0) {
          searchResults.innerHTML =
            '<p class="text-gray-400">No results found.</p>';
          return;
        }
        // Map results to song objects
        const songs = data.items.map((item) => ({
          id: item.id.videoId,
          youtubeVideoId: item.id.videoId,
          title: item.snippet.title,
          artist: item.snippet.channelTitle,
          cover: item.snippet.thumbnails.medium.url,
          source: 'youtube',
        }));
        renderSearchResults(songs);
      } catch (error) {
        searchResults.innerHTML =
          '<p class="text-red-500">Error fetching search results. Please try again later.</p>';
        console.error(error);
      }
    }

    // RENDER SEARCH RESULTS
    function renderSearchResults(songs) {
      searchResults.innerHTML = '';
      songs.forEach((song) => {
        const div = document.createElement('div');
        div.className =
          'flex items-center space-x-4 bg-[#181818] rounded-md p-3 cursor-pointer hover:bg-[#282828] transition';
        div.setAttribute('tabindex', '0');
        div.setAttribute(
          'aria-label',
          `Play song: ${song.title} by ${song.artist}`
        );

        div.innerHTML = `
          <img src="${song.cover}" alt="Cover art of ${song.title} by ${song.artist}" class="w-12 h-12 rounded-md object-cover" loading="lazy" />
          <div class="flex flex-col truncate">
            <p class="font-semibold truncate">${song.title}</p>
            <p class="text-gray-400 text-sm truncate">${song.artist}</p>
          </div>
          <button aria-label="Save song to library" title="Save song" class="text-gray-400 hover:text-green-500 focus:outline-none save-search-song">
            <i class="far fa-heart"></i>
          </button>
        `;

        div.querySelector('button.save-search-song').addEventListener('click', (e) => {
          e.stopPropagation();
          saveSong(song);
        });

        div.addEventListener('click', () => {
          playSong(song);
        });

        searchResults.appendChild(div);
      });
    }

    // INITIAL SETUP
    function init() {
      navHome.click();
      renderSavedSongs();
      renderCreatedPlaylists();
    }

    init();
  </script>
 </body>
</html>